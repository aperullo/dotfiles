#!/bin/bash
set -e -o pipefail

# Install pyenv and Python 3.13 on Ubuntu

if [ -f "/etc/debian_version" ]; then
    # Install dependencies for building Python
    sudo apt-get update
    sudo apt-get install -y \
        make build-essential libssl-dev zlib1g-dev \
        libbz2-dev libreadline-dev libsqlite3-dev wget curl \
        llvm libncurses5-dev liblzma-dev git \
        tk-dev libffi-dev

    # Install pyenv if not installed
    if ! command -v pyenv >/dev/null 2>&1; then
        curl https://pyenv.run | bash
        export PATH="$HOME/.pyenv/bin:$PATH"
        eval "$(pyenv init --path)"
        eval "$(pyenv init -)"
    else
        export PATH="$HOME/.pyenv/bin:$PATH"
        eval "$(pyenv init --path)"
        eval "$(pyenv init -)"
    fi

    # Install Python 3.13 (latest release)
    if ! pyenv versions | grep -q "3.13"; then
        pyenv install -v 3.13.0
    fi
fi
